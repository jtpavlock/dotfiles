#!/bin/bash
#
# define bash prompt

# colors
GREY="\[$(tput bold; tput setaf 0)\]"
GREEN="\[$(tput bold; tput setaf 2)\]"
YELLOW="\[$(tput bold; tput setaf 3)\]"
MAGENTA="\[$(tput bold; tput setaf 5)\]"
CYAN="\[$(tput bold; tput setaf 6)\]"
WHITE="\[$(tput bold; tput setaf 7)\]"
RED="\[$(tput bold; tput setaf 1)\]"
RESET="\[$(tput sgr0)\]"

function set_prompt_symbol_color() {
    # get exit status of last command
    if [[ $? == 0 ]]; then
        EXIT_CODE_COLOR="${WHITE}"
    else
        EXIT_CODE_COLOR="${RED}"
    fi
}

function set_virtualenv() {
    if [[ -z "${VIRTUAL_ENV}" ]]; then
        PYTHON_VIRTUALENV=""
    else
        PYTHON_VIRTUALENV="${CYAN}(${VIRTUAL_ENV##*/})"
    fi
}

function bash_prompt() {
    set_prompt_symbol_color
    set_virtualenv

    # finally, set PS1
    PS1="${MAGENTA}\u ${GREY}at${YELLOW} \h \
${GREY}in${GREEN} \w ${PYTHON_VIRTUALENV}\
\n${SCREEN_ESC}${EXIT_CODE_COLOR}\\\$${RESET} "
}

# call _bash_prompt() each time the prompt is refreshed
export PROMPT_COMMAND=bash_prompt
